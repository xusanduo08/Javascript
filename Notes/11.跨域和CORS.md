## 跨域和CORS

* 什么是域（源）
* 什么是跨域
* 为什么会有跨域
* 为什么有同源策略（SOP）
* 什么是跨域资源共享（CORS）

### 什么是域（源）

Origin，翻译成中文是起源，源头的意思。在浏览器中，源就是是是网页的来源，由**协议**、**端口号**、**主机地址**三部分组成。如果两个网页地址的协议、端口、主机地址都一样，则说这两个网页是同源的；如果协议、端口、主机地址有任意一个不一样，则说这两个网页是非同源的。

源在某些场景下也会叫做**域**，比如跨域（Cross Origin）。域和源的概念一样，只不过换了个叫法而已。

### 什么是跨域

不同源的页面和页面以及页面和服务器之间进行数据访问叫做**跨域**。举个例子，A、B两个页面不同源，从A页面访问B页面的DOM，需要跨域；或者A页面发请求到后端C，A页面地址和服务器C的地址不一样，也需要跨域。

可以把协议、端口、主机地址理解成页面所在的“地域”，每个页面都有自己的“地域”，由A地域访问B地域自然需要跨域。

### 为什么需要跨域

跨域是为了获取数据。

如果产品功能简单，系统也不复杂，那么可能前后端都部署在一台机器上，前台也只有一个页面，这种情况下基本不会有跨域发生。

但这种理想情况一般不存在。

正常情况下，产品功能会比较复杂并且用户也非常多，这时仍将前后端部署在一台机器上就有些不现实了，毕竟一台机器能承受的访问量是有限的，而且还要考虑容灾等各种问题。另外，当业务场景增加时，在A页面通过iframe嵌套B页面的情况也有可能发生。

以上提到两种场景都需要靠跨域来完成。可以说，跨域在前端开发中是躲不掉的。

### 为什么要有同源策略

Same-origin policy，SOP，同源策略。具体内容是指不同源的程序之间数据访问是禁止的，而处于处于同一个源之下的程序之间是可以进行数据交互的。

浏览器做的假设是任何时候只要用户开始使用互联网应用，这个应用就开始尝试攻击这个用户，也就是说互联网应用是默认不可信的，浏览器在它们可能做的任何事情上都加了限制，并且只对它们的限制提供有限的错误信息，[出自这里](https://github.com/solid/web-access-control-spec/blob/master/Background.md)。

举个例子：我登录了我的网上银行页面，此时在其他页面出现了一个弹窗广告，我不小心点击之后弹出了一个含有恶意脚本的页面。这个恶意脚本会从它所在页面向我的网上银行发送获取我个人信息的请求，因为我此时是登录状态，所以该请求会自动携带我登录网上银行的令牌，通过银行后端的身份验证后，银行会把信息返回给恶意脚本所在页面，因为没有同源策略的限制，恶意脚本能获取到银行返回的信息，这样我的个人信息就泄露了。

上面举的例子就是一个典型的CSRF攻击。为了避免这样情况的发生，需要限制不同源之间数据的访问。

### 什么是跨域资源共享（Cross-Origin Resource Sharing, CORS）

有了同源策略互联网的安全性是增加了，但灵活性也降低了。毕竟有些时候跨域资源访问是存在的，比如，网上有很多开放的查询类API，这些API的访问地址和使用者程序地址肯定是不同源的，如果同源策略“一刀切”的话，那就没法直接从前端访问这些API了，这种情况从开发角度来讲，就比较麻烦，可能就需要在中间加一层转发。

CORS是一个系统，它由一系列传输的HTTP头组成，这些HTTP头决定浏览器是否阻止前端JavaScript代码获取跨域请求的响应。CORS默认阻止跨域获取资源。但是CORS给了web服务器这样的权限，即服务器可以选择，允许跨域请求访问到它们的资源。[来自这里](https://developer.mozilla.org/zh-CN/docs/Glossary/CORS)















